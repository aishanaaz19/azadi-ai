<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azadi AI - Independence Day Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&display=swap');

        :root {
            /* Modern Independence Color Palette */
            --saffron-primary: #FF7A00;
            --saffron-light: #FFB366;
            --saffron-dark: #E65100;
            --white-primary: #FFFFFF;
            --white-soft: #F8FAFC;
            --white-muted: #F1F5F9;
            --green-primary: #059669;
            --green-light: #10B981;
            --green-dark: #047857;
            --navy-primary: #1E293B;
            --navy-light: #334155;
            --navy-muted: #64748B;
            --red-error: #dc2626;
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.18);
            --shadow-soft: 0 8px 32px rgba(31, 38, 135, 0.37);
            --shadow-elevation: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #ff9933 0%, #ffffff 35%, #ffffff 65%, #138808 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            gap: 24px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 122, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(5, 150, 105, 0.1) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .main-container {
            width: 100%;
            max-width: 520px;
        }
        
        /* --- CHAT STYLES --- */
        .header-container {
            width: 100%;
            padding: 40px 32px;
            text-align: center;
            margin-bottom: 12px;
            position: relative;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            overflow: hidden;
        }

        .header-container h1 {
            font-family: 'Orbitron', 'Space Grotesk', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 16px;
            letter-spacing: 0.05em;
            position: relative;
            z-index: 2;
            background: linear-gradient(135deg, var(--saffron-primary) 0%, var(--green-primary) 50%, var(--saffron-primary) 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .flag-icon {
            display: inline-block;
            width: 42px;
            height: 28px;
            margin: 0 16px;
            border-radius: 8px;
            background: linear-gradient(to bottom, var(--saffron-primary) 33.33%, var(--white-primary) 33.33%, var(--white-primary) 66.66%, var(--green-primary) 66.66%);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            vertical-align: middle;
        }

        .flag-icon::after {
            content: '☸';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            color: var(--navy-primary);
            animation: chakraSpin 12s linear infinite;
        }

        @keyframes chakraSpin {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .header-container p {
            color: var(--navy-primary);
            font-size: 1.1rem;
            font-weight: 500;
        }

        #chat-container {
            width: 100%;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: var(--shadow-elevation);
            overflow: hidden;
            border: 1px solid var(--glass-border);
        }

        #response-area {
            height: 420px;
            overflow-y: auto;
            padding: 24px;
            background: rgba(248, 250, 252, 0.8);
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .message {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .message.user { flex-direction: row-reverse; }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
            font-weight: 600;
            flex-shrink: 0;
            box-shadow: var(--shadow-soft);
        }

        .bot-avatar { background: linear-gradient(135deg, var(--saffron-primary), var(--green-primary)); }
        .user-avatar { background: linear-gradient(135deg, var(--green-primary), var(--saffron-primary)); }

        .message-wrapper {
            display: flex;
            flex-direction: column;
            max-width: 75%;
        }

        .message-content {
            padding: 16px 20px;
            border-radius: 20px;
            box-shadow: var(--shadow-soft);
        }

        .message.user .message-content {
            background: linear-gradient(135deg, var(--saffron-primary), var(--saffron-light));
            color: white;
        }

        .message.bot .message-content {
            background: var(--white-primary);
            color: var(--navy-primary);
        }

        .speaker-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--saffron-primary), var(--green-primary));
            color: white;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 8px;
            align-self: flex-start;
        }

        .speaker-btn.speaking {
            background: linear-gradient(135deg, #dc2626, #ef4444);
        }

        .input-container {
            padding: 24px;
            background: rgba(255, 255, 255, 0.9);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            gap: 12px;
            align-items: center;
            position: relative;
        }

        #userInput {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid rgba(30, 41, 59, 0.1);
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
        }
        
        #micBtn, #uploadBtn, #sendBtn {
            width: 52px;
            height: 52px;
            border: none;
            border-radius: 50%;
            font-size: 1.4rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: var(--shadow-soft);
        }

        #micBtn {
             background: linear-gradient(135deg, var(--navy-primary), var(--navy-light));
             color: white;
        }
        #micBtn.recording {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
        }

        #uploadBtn {
            background: linear-gradient(135deg, var(--navy-primary), var(--navy-light));
            color: white;
        }

        #sendBtn {
            background: linear-gradient(135deg, var(--saffron-primary), var(--green-primary));
            color: white;
        }

        .speech-status {
            display: none;
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 41, 59, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
        }
        .speech-status.show { display: block; }
        
        .quiz-action-section {
            padding: 16px 24px; 
            text-align: center; 
            border-top: 1px solid rgba(30, 41, 59, 0.1);
        }

        #quizButton {
            width: 100%; 
            padding: 16px; 
            font-size: 1.1rem; 
            font-weight: 600; 
            cursor: pointer; 
            border: none; 
            border-radius: 20px; 
            color: white; 
            background: linear-gradient(135deg, var(--green-primary), var(--green-dark)); 
            box-shadow: var(--shadow-soft);
        }

        /* --- QUIZ STYLES --- */
        .quiz-container {
            width: 100%;
            max-width: 600px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: var(--shadow-elevation);
            border: 1px solid var(--glass-border);
            padding: 40px;
            text-align: center;
            color: var(--navy-primary);
        }

        #question-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.75rem;
            font-weight: 700;
        }

        .btn-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 24px 0;
        }

        .btn {
            background: linear-gradient(135deg, var(--navy-primary), var(--navy-light));
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 16px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn.correct { background: linear-gradient(135deg, var(--green-primary), var(--green-dark)); }
        .btn.wrong { background: linear-gradient(135deg, var(--red-error), #b91c1c); }
        .btn:disabled { cursor: not-allowed; opacity: 0.7; }

        #score-container {
            font-size: 1.25rem;
            font-weight: 700;
        }

        #results-container h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
        }

        #badge { font-size: 5rem; }

        .back-btn {
            margin-top: 24px;
            background: linear-gradient(135deg, var(--saffron-primary), var(--saffron-light));
        }

    </style>
</head>
<body>
    <!-- Main container for switching views -->
    <div class="main-container">
        
        <!-- Chat View -->
        <div id="chat-view">
            <div class="header-container">
                <h1><span class="flag-icon"></span>Azadi AI<span class="flag-icon"></span></h1>
                <p>Celebrating freedom with intelligent conversations</p>
            </div>
            <div id="chat-container">
                <div id="response-area">
                    <div class="message bot">
                        <div class="message-avatar bot-avatar">🤖</div>
                        <div class="message-wrapper">
                            <div class="message-content">Hello! I am Azadi AI. Ask me about Independence Day or play the quiz!</div>
                            <button class="speaker-btn" onclick="speakText(this)">🔊</button>
                        </div>
                    </div>
                </div>
                <div class="input-container">
                    <div class="speech-status" id="speechStatus">Listening...</div>
                    <input type="text" id="userInput" placeholder="Ask me something..." />
                    <button id="uploadBtn" aria-label="Upload image">🖼️</button>
                    <button id="micBtn" aria-label="Voice input">🎤</button>
                    <button id="sendBtn" aria-label="Send message">➤</button>
                </div>
                <div class="quiz-action-section">
                    <button id="quizButton">🇮🇳 Play the Independence Day Quiz!</button>
                </div>
            </div>
        </div>

        <!-- Quiz View (Initially Hidden) -->
        <div id="quiz-view" class="quiz-container" style="display: none;">
            <div id="quiz-content">
                <div id="question-container">
                    <p id="question-text">Question goes here</p>
                    <p id="question-counter">Question 1 / 5</p>
                </div>
                <div id="answer-buttons" class="btn-grid"></div>
                <div id="controls">
                    <div id="score-container">Score: 0</div>
                </div>
            </div>
            <div id="results-container" style="display: none;">
                <h2>Quiz Finished!</h2>
                <p id="final-score"></p>
                <p id="badge"></p>
                <p id="badge-text"></p>
                <button id="back-to-chat-btn" class="btn back-btn">Back to Azadi AI</button>
            </div>
        </div>

    </div>

    <script>
        // --- CHATBOT SCRIPT ---
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const responseArea = document.getElementById('response-area');
        const micBtn = document.getElementById('micBtn');
        const uploadBtn = document.getElementById('uploadBtn');
        const speechStatus = document.getElementById('speechStatus');

        let recognition = null;
        let isRecording = false;
        let currentSpeech = null;

        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.lang = 'en-US';
                
                recognition.onstart = () => {
                    isRecording = true;
                    micBtn.classList.add('recording');
                    speechStatus.textContent = 'Listening...';
                    speechStatus.classList.add('show');
                };
                
                recognition.onresult = (event) => {
                    let transcript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        transcript += event.results[i][0].transcript;
                    }
                    userInput.value = transcript;
                };
                
                recognition.onend = () => {
                    isRecording = false;
                    micBtn.classList.remove('recording');
                    speechStatus.classList.remove('show');
                };
                
                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    isRecording = false;
                    micBtn.classList.remove('recording');
                    speechStatus.textContent = `Error: ${event.error}`;
                };
            } else {
                console.warn("Speech recognition not supported.");
            }
        }

        function toggleSpeechRecognition() {
            if (!recognition) {
                alert('Speech recognition is not supported in your browser.');
                return;
            }
            if (isRecording) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        function speakText(buttonElement) {
            const textToSpeak = buttonElement.parentElement.querySelector('.message-content').textContent;
            if (currentSpeech) {
                speechSynthesis.cancel();
            }
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(textToSpeak);
                utterance.onstart = () => {
                    currentSpeech = utterance;
                    document.querySelectorAll('.speaker-btn').forEach(btn => btn.classList.remove('speaking'));
                    buttonElement.classList.add('speaking');
                };
                utterance.onend = () => {
                    currentSpeech = null;
                    buttonElement.classList.remove('speaking');
                };
                speechSynthesis.speak(utterance);
            }
        }

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const avatar = document.createElement('div');
            avatar.className = `message-avatar ${isUser ? 'user-avatar' : 'bot-avatar'}`;
            avatar.textContent = isUser ? '👤' : '🤖';
            
            const messageWrapper = document.createElement('div');
            messageWrapper.className = 'message-wrapper';

            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.textContent = content;
            
            messageWrapper.appendChild(messageContent);

            if (!isUser) {
                const speakerBtn = document.createElement('button');
                speakerBtn.className = 'speaker-btn';
                speakerBtn.innerHTML = '🔊';
                speakerBtn.setAttribute('aria-label', 'Read message aloud');
                speakerBtn.onclick = () => speakText(speakerBtn);
                messageWrapper.appendChild(speakerBtn);
            }
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageWrapper);
            responseArea.appendChild(messageDiv);
            responseArea.scrollTop = responseArea.scrollHeight;
        }

        async function sendMessage() {
            const messageText = userInput.value.trim();
            if (!messageText) return;

            addMessage(messageText, true);
            userInput.value = '';

            try {
                const response = await fetch('/send-to-dialogflow', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: messageText })
                });
                const data = await response.json();
                addMessage(data.reply || 'Sorry, an error occurred.');
            } catch (error) {
                addMessage('Sorry, I\'m having trouble connecting.');
                console.error('Error:', error);
            }
        }

        sendBtn.addEventListener('click', sendMessage);
        micBtn.addEventListener('click', toggleSpeechRecognition);
        uploadBtn.addEventListener('click', () => {
            alert('Image upload feature is coming soon!');
        });
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });


        // --- QUIZ SCRIPT ---
        const questions = [
            { question: "Who wrote 'Jana Gana Mana'?", answers: [{ text: "Rabindranath Tagore", correct: true }, { text: "Bankim Chandra Chatterjee", correct: false }] },
            { question: "Who is the 'Iron Man of India'?", answers: [{ text: "Jawaharlal Nehru", correct: false }, { text: "Sardar Vallabhbhai Patel", correct: true }] },
            { question: "Jallianwala Bagh is in which city?", answers: [{ text: "Delhi", correct: false }, { text: "Amritsar", correct: true }] },
            { question: "What is India's national motto?", answers: [{ text: "Jai Hind", correct: false }, { text: "Satyameva Jayate", correct: true }] },
            { question: "Who designed the Indian flag?", answers: [{ text: "Mahatma Gandhi", correct: false }, { text: "Pingali Venkayya", correct: true }] }
        ];

        const chatView = document.getElementById('chat-view');
        const quizView = document.getElementById('quiz-view');
        const quizButton = document.getElementById('quizButton');
        const backToChatBtn = document.getElementById('back-to-chat-btn');

        const questionTextElement = document.getElementById('question-text');
        const questionCounterElement = document.getElementById('question-counter');
        const answerButtonsElement = document.getElementById('answer-buttons');
        const scoreElement = document.getElementById('score-container');
        const quizContentElement = document.getElementById('quiz-content');
        const resultsContainerElement = document.getElementById('results-container');
        const finalScoreElement = document.getElementById('final-score');
        const badgeElement = document.getElementById('badge');
        const badgeTextElement = document.getElementById('badge-text');

        let currentQuestionIndex = 0;
        let score = 0;
        
        function startQuiz() {
            chatView.style.display = 'none';
            quizView.style.display = 'block';
            
            currentQuestionIndex = 0;
            score = 0;
            scoreElement.innerText = `Score: ${score}`;
            resultsContainerElement.style.display = 'none';
            quizContentElement.style.display = 'block';
            showQuestion();
        }

        function showQuestion() {
            resetState();
            const currentQuestion = questions[currentQuestionIndex];
            questionTextElement.innerText = currentQuestion.question;
            questionCounterElement.innerText = `Question ${currentQuestionIndex + 1} / ${questions.length}`;
            
            const answerOptions = [ ...currentQuestion.answers ];
            // Pad with some generic wrong answers if less than 4 options
            while(answerOptions.length < 4) {
                answerOptions.push({text: "Not this one", correct: false});
            }

            answerOptions.forEach(answer => {
                const button = document.createElement('button');
                button.innerText = answer.text;
                button.classList.add('btn');
                if (answer.correct) {
                    button.dataset.correct = answer.correct;
                }
                button.addEventListener('click', selectAnswer);
                answerButtonsElement.appendChild(button);
            });
        }

        function resetState() {
            while (answerButtonsElement.firstChild) {
                answerButtonsElement.removeChild(answerButtonsElement.firstChild);
            }
        }

        function selectAnswer(e) {
            const selectedButton = e.target;
            const correct = selectedButton.dataset.correct === 'true';
            
            if (correct) {
                score++;
                scoreElement.innerText = `Score: ${score}`;
            }

            Array.from(answerButtonsElement.children).forEach(button => {
                setStatusClass(button, button.dataset.correct === 'true');
                button.disabled = true;
            });

            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < questions.length) {
                    showQuestion();
                } else {
                    showResults();
                }
            }, 1500);
        }

        function setStatusClass(element, correct) {
            if (correct) {
                element.classList.add('correct');
            } else {
                element.classList.add('wrong');
            }
        }
        
        function showResults() {
            quizContentElement.style.display = 'none';
            resultsContainerElement.style.display = 'block';
            finalScoreElement.innerText = `Your final score is ${score} out of ${questions.length}.`;
            if (score >= 4) {
                badgeElement.innerText = '🏆';
                badgeTextElement.innerText = 'Congratulations! You earned the Freedom Fighter Badge!';
            } else {
                badgeElement.innerText = '👍';
                badgeTextElement.innerText = 'Good effort! Keep learning about our history.';
            }
        }
        
        function showChat() {
            quizView.style.display = 'none';
            chatView.style.display = 'block';
        }

        quizButton.addEventListener('click', startQuiz);
        backToChatBtn.addEventListener('click', showChat);

        window.onload = function() {
            userInput.focus();
            initSpeechRecognition();
        };

    </script>
</body>
</html>
